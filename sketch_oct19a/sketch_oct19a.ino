#include <ESP8266WiFi.h>
#include <FirebaseArduino.h>
#include "DHTesp.h"


#ifndef UNIT_TEST
#include <Arduino.h>
#endif
#include <IRremoteESP8266.h>
#include <IRsend.h>

// Set these to run example.
#define FIREBASE_HOST "dht-11-14408.firebaseio.com"
#define FIREBASE_AUTH "5ba7ErieVRtTLB7WyWvwU9tgSTpc2FseT4LPz7wf"
#define WIFI_SSID "Rede Academica"//XT1635-02
#define WIFI_PASSWORD ""//teste123

DHTesp dht;
const uint16_t kIrLed = 4;  // ESP8266 GPIO pin to use. Recommended: 4 (D2).
IRsend irsend(kIrLed);  // Set the GPIO to be used to sending the message.


void setup() {

  irsend.begin();
  Serial.begin(9600, SERIAL_8N1, SERIAL_TX_ONLY);
  dht.setup(16, DHTesp::DHT11);
  // connect to wifi.
  WiFi.begin(WIFI_SSID, WIFI_PASSWORD);
  Serial.print("connecting");
  while (WiFi.status() != WL_CONNECTED) {
    Serial.print(".");
    delay(500);
  }
  Serial.println();
  Serial.print("connected: ");
  Serial.println(WiFi.localIP());
  
  Firebase.begin(FIREBASE_HOST, FIREBASE_AUTH);
  if(Firebase.success()){
    Serial.print("reconectado ao firebase");
  }
  if(Firebase.failed()){
    Serial.print(Firebase.error());
  }
}
int n = 0;

void loop() {
  if(WiFi.status() != WL_CONNECTED){
    setup();
  }
  if(Firebase.failed()){
    Serial.print(Firebase.error());
  }
 
  float humid = dht.getHumidity();
  float temp = dht.getTemperature();
 uint16_t Ligar[91] = {9034, 4524,  572, 604,  542, 632,  540, 1758,  544,
                        632,  540, 1758,  544, 630,  544, 630,  544, 630,  542,
                        636,  538, 1758,  542, 632,  568, 606,  542, 632,  542,
                        634,  544, 1754,  542, 1756,  566, 608,  570, 606,  570,
                        604,  568, 606,  568, 610,  538, 636,  566, 606,  568, 610,
                        540, 634,  570, 604,  568, 606,  542, 634,  540, 634,  540,
                        634,  544, 630,  542, 634,  540, 634,  542, 630,  570, 606,
                        540, 632,  572, 602,  546, 630,  566, 606,  570, 606,  544,
                        1758,  566, 1728,  572, 1726,  542, 632,  544};  // Lab-2
                        
 uint16_t Desligar[91] = {9062, 4494,  546, 632,  568, 608,  568, 1728,  542, 636,  540,
                        634,  566, 612,  538, 634,  568, 606,  540, 636,  540, 1758,  542,
                        634,  538, 636,  542, 1756,  542, 634,  538, 1758,  542, 634,  542,
                        632,  542, 636,  534, 636,  540, 636,  540, 630,  568, 608,  542, 632,
                        540, 636,  542, 634,  538, 634,  572, 604,  538, 634,  542, 632,  562,
                        612,  542, 636,  536, 676,  502, 632,  542, 636,  540, 632,  558, 616,
                        560, 616,  540, 634,  544, 632,  540, 634,  568, 1728,  568, 1730,  544,
                        1756,  538, 1758,  544};  // UNKNOWN FF5ADE89


/**
uint16_t Ligar[197] = {6012, 7426,  512, 1712,  548, 1622,  510, 1736,  522, 1624,  508, 1742,  496,
                       1646,  508, 1736,  522, 1624,  508, 672,  498, 580,  506, 674,  522, 556,  508,
                       670,  520, 556,  510, 672,  518, 560,  508, 1738,  522, 1620,  512, 1736,  520,
                       1664,  470, 1738,  500, 1648,  506, 1738,  522, 1624,  528, 654,  496, 626,  456,
                       674,  520, 556,  534, 646,  520, 558,  508, 670,  522, 552,  512, 1736,  522, 1628,
                       524, 1718,  520, 1626,  528, 1714,  524, 1682,  520, 1664,  524, 1664,  544, 558,
                       506, 670,  522, 594,  472, 672,  516, 598,  522, 618,  524, 594,  520, 560,  580, 
                       1626,  508, 608,  582, 564,  556, 1682,  526, 556,  558, 1696,  512, 1626,  504,
                       1740,  524, 552,  510, 1742,  522, 1620,  506, 670,  526, 1618,  512, 680,  514,
                       554,  510, 672,  522, 1622,  506, 1742,  520, 1622,  508, 680,  516, 1618,  510,
                       636,  556, 1622,  510, 1700,  558, 552,  514, 676,  514, 556,  510, 1700,  562, 548,
                       514, 1740,  520, 554,  506, 676,  520, 552,  508, 1746,  516, 554,  508, 1744,  520,
                       554,  508, 1742,  518, 558,  508, 674,  518, 1622,  510, 668,  526, 1618,  512, 672,
                       522, 1618,  512, 670,  522, 1622,  510, 1738,  522, 7412,  524};  //sala de professores
                       
uint16_t Desligar[197] = {6100, 7412,  522, 1628,  504, 1742,  520, 1622,  510, 1712,  546, 1624,  510, 1736,
                         524, 1620,  512, 1738,  498, 582,  506, 674,  520, 558,  508, 670,  524, 552,  508,
                         672,  526, 552,  564, 616,  522, 1662,  524, 1684,  524, 1660,  526, 1682,  522, 1662,
                         524, 1622,  588, 1662,  522, 1684,  524, 594,  526, 558,  504, 646,  520, 556,  512,
                         670,  522, 554,  508, 674,  522, 556,  562, 1686,  522, 1662,  470, 1742,  518, 1622,
                         510, 1740,  520, 1660,  470, 1726,  536, 1628,  504, 672,  522, 556,  562, 556,  584,
                         598,  522, 558,  506, 636,  558, 556,  506, 682,  514, 1620,  512, 1744,  516, 556,  512,
                         1736,  522, 554,  510, 1738,  526, 1618,  512, 1740,  522, 554,  510, 674,  518, 1622,
                         512, 674,  518, 1624,  510, 672,  520, 554,  564, 558,  530, 1676,  562, 1686,  518, 1664,
                         528, 584,  500, 1720,  524, 592,  468, 1742,  522, 1620,  512, 674,  518, 556,  510, 672,
                         522, 1622,  508, 672,  520, 1624,  508, 670,  524, 556,  510, 668,  522, 1664,  524, 596,
                         536, 1670,  522, 596,  536, 1670,  522, 600,  466, 672,  522, 1622,  506, 674,  522, 1618,
                         514, 670,  522, 1622,  512, 674,  518, 1624,  510, 1738,  526, 7438,  522}; 

uint16_t Ligar[199] = {4494, 4546,  548, 1632,  590, 572,  548, 1672,  548, 1676,  546, 568,  554, 578,  542, 1638,
                       582, 534,  588, 578,  546, 1674,  544, 574,  550, 578,  542, 1670,  550, 1670,  550, 570,  552,
                       1666,  552, 1672,  548, 578,  546, 1674,  544, 1670,  550, 1674,  546, 1668,  550, 1670,  550, 
                       1632,  586, 572,  552, 1680,  538, 582,  542, 582,  540, 574,  552, 570,  550, 576,  546, 576,  
                       552, 576,  542, 572,  552, 580,  544, 564,  558, 582,  542, 572,  550, 530,  590, 578,  548, 
                       1674,  542, 1672,  552, 1674,  544, 1638,  582, 1678,  542, 1708,  512, 1668,  550, 1632,  590, 
                       5248,  4496, 4540,  552, 1666,  554, 580,  540, 1670,  554, 1676,  540, 576,  550, 578,  542, 1674,  
                       546, 570,  552, 572,  548, 1630,  592, 578,  540, 572,  554, 1672,  546, 1630,  590, 534,  590, 1672,  
                       544, 1670,  554, 576,  542, 1678,  544, 1666,  554, 1678,  540, 1678,  542, 1674,  548, 1666,  552, 
                       534,  590, 1676,  540, 540,  584, 570,  552, 534,  588, 576,  546, 574,  548, 614,  508, 576,  548, 
                       586,  540, 610,  512, 532,  592, 570,  552, 538,  582, 578,  548, 610,  510, 1676,  544, 1636,  584, 
                       1630,  590, 1678,  542, 1668,  552, 1634,  586, 1630,  588, 1674,  546};  // COOLIX B2BF00
uint16_t Desligar[199] = {4496, 4538,  552, 1700,  520, 578,  544, 1668,  552, 1632,  584, 572,  552, 574,  548, 1670,  552, 578,  544, 574,  548, 1672,  550, 570,  550, 580,  542, 1710,  512, 1676,  542, 568,  552, 1672,  548, 532,  592, 1666,  550, 1670,  554, 1666,  550, 1670,  550, 530,  592, 1670,  550, 1666,  552, 1672,  548, 572,  550, 582,  544, 570,  552, 574,  548, 1668,  552, 576,  546, 610,  510, 1636,  584, 1636,  584, 1666,  554, 570,  554, 568,  556, 570,  552, 574,  546, 572,  554, 570,  552, 570,  554, 576,  542, 1674,  550, 1668,  550, 1624,  598, 1662,  556, 1668,  550, 5250,  4492, 4542,  554, 1668,  548, 536,  584, 1670,  552, 1668,  552, 566,  556, 578,  542, 1674,  546, 576,  546, 534,  588, 1670,  552, 532,  594, 570,  552, 1672,  548, 1666,  552, 574,  548, 1668,  550, 578,  544, 1680,  542, 1676,  542, 1672,  550, 1666,  554, 574,  546, 1630,  592, 1670,  546, 1668,  554, 572,  550, 570,  552, 572,  550, 572,  552, 1666,  552, 566,  556, 572,  550, 1658,  560, 1668,  552, 1668,  550, 536,  590, 574,  544, 572,  554, 570,  550, 572,  552, 532,  590, 572,  550, 570,  554, 1610,  608, 1668,  554, 1670,  552, 1668,  550, 1634,  586};  // COOLIX B27BE0
**/
//
//int ligar = 0x2FD48B7;


delay(100);
  if (Firebase.success()) {
    FirebaseObject dht11 = Firebase.get("dht11");
    Serial.print("conectado ao Firebase : temperatura = ");
    Serial.println(dht11.getFloat("/temp"));
    Firebase.set("/dht11/humid",humid);
    Firebase.set("/dht11/temp",temp);
    if (dht11.getString("/Ar")=="on"){
      irsend.sendRaw(Ligar, 199, 38);
      //irsend.sendNEC(ligar);
      delay(1000);
      Firebase.set("/dht11/Ar",true);
    }
    if (dht11.getString("/Ar")=="off"){
      irsend.sendRaw(Desligar,199,38);
      // irsend.sendNEC(ligar);
      delay(1000);
      Firebase.set("/dht11/Ar",true);
    }
  }
}
   
